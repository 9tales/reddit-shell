<!DOCTYPE HTML> 
<html lang="en">
  <head> 
    <title>browse reddit through a web-based shell emulator</title>
    <link href="css/jquery.terminal.css" rel="stylesheet"/>
    <link href="css/style.css" rel="stylesheet"/>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-21656782-17', 'auto');
      ga('send', 'pageview');
    </script>
  </head> 
<body style="margin:0 auto;">
</body>
</html>
<script src="js/jquery-1.7.1.min.js"></script>
<script src="js/jquery.mousewheel-min.js"></script>
<script src="js/jquery.terminal-min.js"></script>
<script src="js/moment.min.js"></script>   
<script type="text/javascript">
$(function() {
  var posts = [];
  var comments = [];
  var subreddits = [];
  var content = [];
  var next = "";
  var previous = "";
  var c = 0;
  var r = 0;
  var s = 0;
  var u = 0;
  var anim = false;
  function typed(finish_typing) {
    return function(term, message, delay, finish) {
      anim = true;
      var prompt = term.get_prompt();
      var c = 0;
      if (message.length > 0) {
        term.set_prompt('[guest@reddit ~]# ');
        var interval = setInterval(function() {
          term.insert(message[c++]);
          if (c == message.length) {
            clearInterval(interval);
            setTimeout(function() {
              finish_typing(term, message, prompt);
              anim = false
              finish && finish();
            }, delay);
          }
        }, delay);
      }
    };
  }

  var typed_prompt = typed(function(term, message, prompt) {
    term.set_command('');
    term.set_prompt(message + ' ');
  });

  var typed_message = typed(function(term, message, prompt) {
      term.set_command('');
      term.echo(message)
      term.set_prompt(prompt);
  });

  function greetings(term) {
    term.echo('reddit shell v0.1 by <a href="https://twitter.com/jasonbeee" target="_blank">@jasonbeee</a> - <a href="https://github.com/jasonbio/reddit-shell" target="_blank">fork this project on github</a><p />' + 
      '- "<b style="color:#fff;">reddit list</b>" or "<b style="color:#fff;">reddit list [subreddit]</b>" to list the latest posts from the front page or specified subreddit<br />' + 
      '- "<b style="color:#fff;">reddit list [subreddit] next</b>" or "<b style="color:#fff;">reddit list [subreddit] previous</b>" to navigate through pages (leave subreddit out if browsing the homepage)<br />' + 
      '- "<b style="color:#fff;">reddit view content [index]</b>" to open the content URL in a new window<br />' + 
      '- "<b style="color:#fff;">reddit view comments [index]</b>" to view the comments for the post<br />' + 
      '- "<b style="color:#fff;">reddit view comments more [index]</b>" to view more comments in a chain<br />' + 
      '- "<b style="color:#fff;">clear</b>" to clear the screen<br />' + 
      '- "<b style="color:#fff;">help</b>" to display these instructions again<p />', {raw:true});
  }

  $('body').terminal(function(cmd, term) {
    var finish = false;
    term.set_prompt('[guest@reddit ~]# ');
    var frontpage = "";
    command = cmd.split(" ");
    // LIST FRONTPAGE
    if (cmd == "reddit list") {
      posts = [];
      content = [];
      next = "";
      previous = "";
      c = 0;
      $.getJSON('http://www.reddit.com/.json?jsonp=?', function(data) {
        var redditjson = data.data.children;
        $(redditjson).each(function() {
          if (this.data != undefined) {
            permalink = "http://reddit.com"+this.data.permalink;
            url = this.data.url;
            content.push(url);
            posts.push(permalink);
            // line 1
            title = this.data.title;
            domain = this.data.domain;
            subreddit = this.data.subreddit;
            if (url) {
              line1 = "<a href='"+url+"' target='_blank'>"+title + "</a> (" + domain + ")<br />";
            } else {
              line1 = title + " (" + domain + ")<br />";
            }
            // line 2
            created = this.data.created_utc;
            time = moment.unix(created).fromNow();
            author = this.data.author;
            line2 = "submitted " + time + " by " + author + " to /r/" + subreddit + "<br />";
            // line 3
            ups = this.data.ups;
            num_comments = this.data.num_comments;
            line3 = ups + " upvotes with " + num_comments + " comments<p/>";
            frontpage = '[<span style="color: #2C9A96;">' + c + '</span>] ' + line1 + '<span style="margin-left:32px;color: #666;"">' + line2 + line3 + '</span>';
            c = c + 1;
            term.echo(frontpage, {raw:true});
          }
        });
        var after = data.data.after;
        var before = data.data.before;
        if (before != null) {
          permalink = "https://www.reddit.com/.json?count="+c+"&before="+before+"&jsonp=?";
          previous = permalink;
          previous_line = "<span style='margin-left:64px;'>[<span style='color: #B3A600;'>previous</span>]<p />";
          term.echo(previous_line, {raw:true});
        }
        if (after != null) {
          permalink = "https://www.reddit.com/.json?count="+c+"&after="+after+"&jsonp=?";
          next = permalink;
          next_line = "<span style='margin-left:64px;'>[<span style='color: #B3A600;'>next</span>]<p />";
          term.echo(next_line, {raw:true});
          term.set_prompt('[guest@reddit ~]# ');
        }
      });
    // LIST NEXT PAGE
    } else if (cmd == "reddit list next") {
      previous = "";
      $.getJSON(next, function(data) {
        var redditjson = data.data.children;
        $(redditjson).each(function() {
          if (this.data != undefined) {
            permalink = "http://reddit.com"+this.data.permalink;
            url = this.data.url;
            content.push(url);
            posts.push(permalink);
            // line 1
            title = this.data.title;
            domain = this.data.domain;
            subreddit = this.data.subreddit;
            if (url) {
              line1 = "<a href='"+url+"' target='_blank'>"+title + "</a> (" + domain + ")<br />";
            } else {
              line1 = title + " (" + domain + ")<br />";
            }
            // line 2
            created = this.data.created_utc;
            time = moment.unix(created).fromNow();
            author = this.data.author;
            line2 = "submitted " + time + " by " + author + " to /r/" + subreddit + "<br />";
            // line 3
            ups = this.data.ups;
            num_comments = this.data.num_comments;
            line3 = ups + " upvotes with " + num_comments + " comments<p/>";
            frontpage = '[<span style="color: #2C9A96;">' + c + '</span>] ' + line1 + '<span style="margin-left:32px;color: #666;"">' + line2 + line3 + '</span>';
            c = c + 1;
            term.echo(frontpage, {raw:true});
          }
        });
        var after = data.data.after;
        var before = data.data.before;
        if (before != null) {
          permalink = "https://www.reddit.com/.json?count="+c+"&before="+before+"&jsonp=?";
          previous = permalink;
          previous_line = "<span style='margin-left:64px;'>[<span style='color: #B3A600;'>previous</span>]<p />";
          term.echo(previous_line, {raw:true});
        }
        if (after != null) {
          permalink = "https://www.reddit.com/.json?count="+c+"&after="+after+"&jsonp=?";
          next = permalink;
          next_line = "<span style='margin-left:64px;'>[<span style='color: #B3A600;'>next</span>]<p />";
          term.echo(next_line, {raw:true});
          term.set_prompt('[guest@reddit ~]# ');
        }
      });
    // LIST PREVIOUS PAGE
    } else if (cmd == "reddit list previous") {
      next = "";
      $.getJSON(previous, function(data) {
        var redditjson = data.data.children;
        $(redditjson).each(function() {
          if (this.data != undefined) {
            permalink = "http://reddit.com"+this.data.permalink;
            url = this.data.url;
            content.push(url);
            posts.push(permalink);
            // line 1
            title = this.data.title;
            domain = this.data.domain;
            subreddit = this.data.subreddit;
            if (url) {
              line1 = "<a href='"+url+"' target='_blank'>"+title + "</a> (" + domain + ")<br />";
            } else {
              line1 = title + " (" + domain + ")<br />";
            }
            // line 2
            created = this.data.created_utc;
            time = moment.unix(created).fromNow();
            author = this.data.author;
            line2 = "submitted " + time + " by " + author + " to /r/" + subreddit + "<br />";
            // line 3
            ups = this.data.ups;
            num_comments = this.data.num_comments;
            line3 = ups + " upvotes with " + num_comments + " comments<p/>";
            frontpage = '[<span style="color: #2C9A96;">' + c + '</span>] ' + line1 + '<span style="margin-left:32px;color: #666;"">' + line2 + line3 + '</span>';
            c = c - 1;
            term.echo(frontpage, {raw:true});
          }
        });
        var after = data.data.after;
        var before = data.data.before;
        if (before != null) {
          permalink = "https://www.reddit.com/.json?count="+c+"&before="+before+"&jsonp=?";
          previous = permalink;
          previous_line = "<span style='margin-left:64px;'>[<span style='color: #B3A600;'>previous</span>]<p />";
          term.echo(previous_line, {raw:true});
        }
        if (after != null) {
          permalink = "https://www.reddit.com/.json?count="+c+"&after="+after+"&jsonp=?";
          next = permalink;
          next_line = "<span style='margin-left:64px;'>[<span style='color: #B3A600;'>next</span>]<p />";
          term.echo(next_line, {raw:true});
          term.set_prompt('[guest@reddit ~]# ');
        }
      });
    // LIST SUBREDDITS
    } else if (cmd == "reddit list subreddits") {
      subreddits = [];
      next = "";
      previous = "";
      s = 0;
      $.getJSON('http://www.reddit.com/subreddits/.json?jsonp=?', function(data) {
        var redditjson = data.data.children;
        $(redditjson).each(function() {
          if (this.data != undefined) {
            //permalink = "http://reddit.com"+this.data.permalink;
            url = this.data.url;
            //posts.push(permalink);
            // line 1
            display_name = this.data.display_name;
            title = this.data.title;
            line1 = "<a href='http://reddit.com" + url + "' target='_blank'>/r/" + display_name + " - " + title + "</a><br />";
            // line 2
            description = this.data.public_description;
            line2 = description + "<br />";
            // line 3
            subscribers = this.data.subscribers;
            created = this.data.created_utc;
            time = moment.unix(created).fromNow();
            line3 = subscribers + " subscribers since starting " + time + "<p />";
            frontpage = '[<span style="color: #2C9A96;">' + s + '</span>] ' + line1 + '<span style="margin-left:32px;color: #666;"">' + line2 + line3 + '</span>';
            s = s + 1;
            term.echo(frontpage, {raw:true});
            term.set_prompt('[guest@reddit subreddits]# ');
          }
        });
        var after = data.data.after;
        var before = data.data.before;
        if (before != null) {
          permalink = "https://www.reddit.com/subreddits/.json?count="+s+"&before="+before+"&jsonp=?";
          previous = permalink;
          previous_line = "<span style='margin-left:64px;'>[<span style='color: #B3A600;'>previous</span>]<p />";
          term.echo(previous_line, {raw:true});
          term.set_prompt('[guest@reddit subreddits]# ');
        }
        if (after != null) {
          permalink = "https://www.reddit.com/subreddits/.json?count="+s+"&after="+after+"&jsonp=?";
          next = permalink;
          next_line = "<span style='margin-left:64px;'>[<span style='color: #B3A600;'>next</span>]<p />";
          term.echo(next_line, {raw:true});
          term.set_prompt('[guest@reddit subreddits]# ');
        }
      });
    // LIST SUBREDDITS NEXT
   } else if (cmd == "reddit list subreddits next") {
    previous = "";
      $.getJSON(next, function(data) {
        var redditjson = data.data.children;
        $(redditjson).each(function() {
          if (this.data != undefined) {
            //permalink = "http://reddit.com"+this.data.permalink;
            url = this.data.url;
            //posts.push(permalink);
            // line 1
            display_name = this.data.display_name;
            title = this.data.title;
            line1 = "<a href='http://reddit.com" + url + "' target='_blank'>/r/" + display_name + " - " + title + "</a><br />";
            // line 2
            description = this.data.public_description;
            line2 = description + "<br />";
            // line 3
            subscribers = this.data.subscribers;
            created = this.data.created_utc;
            time = moment.unix(created).fromNow();
            line3 = subscribers + " subscribers since starting " + time + "<p />";
            frontpage = '[<span style="color: #2C9A96;">' + s + '</span>] ' + line1 + '<span style="margin-left:32px;color: #666;"">' + line2 + line3 + '</span>';
            s = s + 1;
            term.echo(frontpage, {raw:true});
            term.set_prompt('[guest@reddit subreddits]# ');
          }
        });
        var after = data.data.after;
        var before = data.data.before;
        if (before != null) {
          permalink = "https://www.reddit.com/subreddits/.json?count="+s+"&before="+before+"&jsonp=?";
          previous = permalink;
          previous_line = "<span style='margin-left:64px;'>[<span style='color: #B3A600;'>previous</span>]<p />";
          term.echo(previous_line, {raw:true});
          term.set_prompt('[guest@reddit subreddits]# ');
        }
        if (after != null) {
          permalink = "https://www.reddit.com/subreddits/.json?count="+s+"&after="+after+"&jsonp=?";
          next = permalink;
          next_line = "<span style='margin-left:64px;'>[<span style='color: #B3A600;'>next</span>]<p />";
          term.echo(next_line, {raw:true});
          term.set_prompt('[guest@reddit subreddits]# ');
        }
      });
    // LIST SUBREDDITS PREVIOUS
   } else if (cmd == "reddit list subreddits previous") {
    next = "";
      $.getJSON(previous, function(data) {
        var redditjson = data.data.children;
        $(redditjson).each(function() {
          if (this.data != undefined) {
            //permalink = "http://reddit.com"+this.data.permalink;
            url = this.data.url;
            //posts.push(permalink);
            // line 1
            display_name = this.data.display_name;
            title = this.data.title;
            line1 = "<a href='http://reddit.com" + url + "' target='_blank'>/r/" + display_name + " - " + title + "</a><br />";
            // line 2
            description = this.data.public_description;
            line2 = description + "<br />";
            // line 3
            subscribers = this.data.subscribers;
            created = this.data.created_utc;
            time = moment.unix(created).fromNow();
            line3 = subscribers + " subscribers since starting " + time + "<p />";
            frontpage = '[<span style="color: #2C9A96;">' + s + '</span>] ' + line1 + '<span style="margin-left:32px;color: #666;"">' + line2 + line3 + '</span>';
            s = s - 1;
            term.echo(frontpage, {raw:true});
            term.set_prompt('[guest@reddit subreddits]# ');
          }
        });
        var after = data.data.after;
        var before = data.data.before;
        if (before != null) {
          permalink = "https://www.reddit.com/subreddits/.json?count="+s+"&before="+before+"&jsonp=?";
          previous = permalink;
          previous_line = "<span style='margin-left:64px;'>[<span style='color: #B3A600;'>previous</span>]<p />";
          term.echo(previous_line, {raw:true});
          term.set_prompt('[guest@reddit subreddits]# ');
        }
        if (after != null) {
          permalink = "https://www.reddit.com/subreddits/.json?count="+s+"&after="+after+"&jsonp=?";
          next = permalink;
          next_line = "<span style='margin-left:64px;'>[<span style='color: #B3A600;'>next</span>]<p />";
          term.echo(next_line, {raw:true});
          term.set_prompt('[guest@reddit subreddits]# ');
        }
      });
    // LIST SUBREDDIT
    } else if (command[0] == "reddit" && command[1] == "list" && command[2] && !command[3]) {
      posts = [];
      content = [];
      next = "";
      previous = "";
      c = 0;
      $.getJSON('http://www.reddit.com/r/'+command[2]+'/.json?jsonp=?', function(data) {
        var redditjson = data.data.children;
        $(redditjson).each(function() {
          if (this.data != undefined) {
            permalink = "http://reddit.com"+this.data.permalink;
            url = this.data.url;
            content.push(url);
            posts.push(permalink);
            // line 1
            title = this.data.title;
            domain = this.data.domain;
            if (url) {
              line1 = "<a href='"+url+"' target='_blank'>"+title + "</a> (" + domain + ")<br />";
            } else {
              line1 = title + " (" + domain + ")<br />";
            }
            // line 2
            created = this.data.created_utc;
            time = moment.unix(created).fromNow();
            author = this.data.author;
            line2 = "submitted " + time + " by " + author + "<br />";
            // line 3
            ups = this.data.ups;
            num_comments = this.data.num_comments;
            line3 = ups + " upvotes with " + num_comments + " comments<p />";
            frontpage = '[<span style="color: #2C9A96;">' + c + '</span>] ' + line1 + '<span style="margin-left:32px;color: #666;"">' + line2 + line3 + '</span>';
            c = c + 1;
            term.echo(frontpage, {raw:true});
            term.set_prompt('[guest@reddit '+command[2]+']# ');
          }
        });
        var after = data.data.after;
        var before = data.data.before;
        if (before != null) {
          permalink = "https://www.reddit.com/r/"+command[2]+"/.json?count="+c+"&before="+before+"&jsonp=?";
          previous = permalink;
          previous_line = "<span style='margin-left:64px;'>[<span style='color: #B3A600;'>previous</span>]<p />";
          term.echo(previous_line, {raw:true});
          term.set_prompt('[guest@reddit '+command[2]+']# ');
        }
        if (after != null) {
          permalink = "https://www.reddit.com/r/"+command[2]+"/.json?count="+c+"&after="+after+"&jsonp=?";
          next = permalink;
          next_line = "<span style='margin-left:64px;'>[<span style='color: #B3A600;'>next</span>]<p />";
          term.echo(next_line, {raw:true});
          term.set_prompt('[guest@reddit '+command[2]+']# ');
        }
      });
    // LIST SUBREDDIT NEXT
    } else if (command[0] == "reddit" && command[1] == "list" && command[2] && command[3] == "next") {
      previous = "";
      $.getJSON(next, function(data) {
        var redditjson = data.data.children;
        $(redditjson).each(function() {
          if (this.data != undefined) {
            permalink = "http://reddit.com"+this.data.permalink;
            url = this.data.url;
            content.push(url);
            posts.push(permalink);
            // line 1
            title = this.data.title;
            domain = this.data.domain;
            if (url) {
              line1 = "<a href='"+url+"' target='_blank'>"+title + "</a> (" + domain + ")<br />";
            } else {
              line1 = title + " (" + domain + ")<br />";
            }
            // line 2
            created = this.data.created_utc;
            time = moment.unix(created).fromNow();
            author = this.data.author;
            line2 = "submitted " + time + " by " + author + "<br />";
            // line 3
            ups = this.data.ups;
            num_comments = this.data.num_comments;
            line3 = ups + " upvotes with " + num_comments + " comments<p />";
            frontpage = '[<span style="color: #2C9A96;">' + c + '</span>] ' + line1 + '<span style="margin-left:32px;color: #666;"">' + line2 + line3 + '</span>';
            c = c + 1;
            term.echo(frontpage, {raw:true});
            term.set_prompt('[guest@reddit '+command[2]+']# ');
          }
        });
        var after = data.data.after;
        var before = data.data.before;
        if (before != null) {
          permalink = "https://www.reddit.com/r/"+command[2]+"/.json?count="+c+"&before="+before+"&jsonp=?";
          previous = permalink;
          previous_line = "<span style='margin-left:64px;'>[<span style='color: #B3A600;'>previous</span>]<p />";
          term.echo(previous_line, {raw:true});
          term.set_prompt('[guest@reddit '+command[2]+']# ');
        }
        if (after != null) {
          permalink = "https://www.reddit.com/r/"+command[2]+"/.json?count="+c+"&after="+after+"&jsonp=?";
          next = permalink;
          next_line = "<span style='margin-left:64px;'>[<span style='color: #B3A600;'>next</span>]<p />";
          term.echo(next_line, {raw:true});
          term.set_prompt('[guest@reddit '+command[2]+']# ');
        }
      });
    // LIST SUBREDDIT PREVIOUS
    } else if (command[0] == "reddit" && command[1] == "list" && command[2] && command[3] == "previous") {
      next = "";
      $.getJSON(previous, function(data) {
        var redditjson = data.data.children;
        $(redditjson).each(function() {
          if (this.data != undefined) {
            permalink = "http://reddit.com"+this.data.permalink+".json?jsonp=?";
            url = this.data.url;
            content.push(url);
            posts.push(permalink);
            // line 1
            title = this.data.title;
            domain = this.data.domain;
            if (url) {
              line1 = "<a href='"+url+"' target='_blank'>"+title + "</a> (" + domain + ")<br />";
            } else {
              line1 = title + " (" + domain + ")<br />";
            }
            // line 2
            created = this.data.created_utc;
            time = moment.unix(created).fromNow();
            author = this.data.author;
            line2 = "submitted " + time + " by " + author + "<br />";
            // line 3
            ups = this.data.ups;
            num_comments = this.data.num_comments;
            line3 = ups + " upvotes with " + num_comments + " comments<p />";
            frontpage = '[<span style="color: #2C9A96;">' + c + '</span>] ' + line1 + '<span style="margin-left:32px;color: #666;"">' + line2 + line3 + '</span>';
            c = c - 1;
            term.echo(frontpage, {raw:true});
            term.set_prompt('[guest@reddit '+command[2]+']# ');
          }
        });
        var after = data.data.after;
        var before = data.data.before;
        if (before != null) {
          permalink = "https://www.reddit.com/r/"+command[2]+"/.json?count="+c+"&before="+before+"&jsonp=?";
          previous = permalink;
          previous_line = "<span style='margin-left:64px;'>[<span style='color: #B3A600;'>previous</span>]<p />";
          term.echo(previous_line, {raw:true});
          term.set_prompt('[guest@reddit '+command[2]+']# ');
        }
        if (after != null) {
          permalink = "https://www.reddit.com/r/"+command[2]+"/.json?count="+c+"&after="+after+"&jsonp=?";
          next = permalink;
          next_line = "<span style='margin-left:64px;'>[<span style='color: #B3A600;'>next</span>]<p />";
          term.echo(next_line, {raw:true});
          term.set_prompt('[guest@reddit '+command[2]+']# ');
        }
      });
    // VIEW CONTENT
    } else if (posts.length !== 0 && command[0] == "reddit" && command[1] == "view" && command[2] == "content" && command[3]) {
      var content_url = content[command[3]];
      if (content_url) {
        window.open(content_url);
      }
    // VIEW THREAD
    } else if (posts.length !== 0 && command[0] == "reddit" && command[1] == "view" && command[2] == "comments" && command[3]) {
      comments = [];
      r = 0;
      var json_base = posts[command[3]];
      $.getJSON(posts[command[3]]+".json?jsonp=?", function foo(result) {
        $.each(result[1].data.children, function (i, reply) {
          var reply_message = "";
          var reply2_message = "";
          author = reply.data.author;
          body = reply.data.body;
          created = reply.data.created_utc;
          time = moment.unix(created).fromNow();
          nested_count = 0;
          nest_line1 = "";
          nest_line2 = "";
          nest_line3 = "";
          comments_line = "";
          ups = reply.data.ups;
          line1 = body + "<br />";
          line2 = "<span style='margin-left:32px;color: #666;'>posted " + time + " by " + author + "</span><br/>";
          line3 = "<span style='margin-left:32px;color: #666;'>" + ups + " upvotes with " + nested_count + " replies</span><p />";
          if (reply.data.replies != "") {
            $.each(reply.data.replies.data.children, function (z, reply2) {
              if (reply2.kind != "more") {
                nested_author = reply2.data.author;
                nested_body = reply2.data.body;
                nested_created = reply2.data.created_utc;
                nested_time = moment.unix(nested_created).fromNow();
                nested_ups = reply2.data.ups;
                nest_line1 = "<span style='margin-left:64px;'>" + nested_body + "<br />";
                nest_line2 = "<span style='margin-left:98px;color: #666;'>posted " + nested_time + " by " + nested_author + "</span><br/>";
                nest_line3 = "<span style='margin-left:98px;color: #666;'>" + nested_ups + " upvotes with " + nested_ups + " replies</span><p/>";
                reply_message = line1 + line2 + line3;
                reply_message += nest_line1 + nest_line2 + nest_line3;
                reply_message += comments_line;
              } else {
                nested_count = reply2.data.count;
                nested_id = reply2.data.id;
                if (nested_id) {
                  comments.push(json_base+nested_id);
                  comments_line = "<span style='margin-left:130px;'>[<span style='color: #B3A600;'>" + r + "</span>] view more comments ...<p />";
                  r = r + 1;
                  reply_message = line1 + line2 + line3;
                  reply_message += nest_line1 + nest_line2 + nest_line3;
                  reply_message += comments_line;
                }
              }
            });
            
          } else {
            reply_message = line1 + line2 + line3;
            reply_message += nest_line1 + nest_line2 + nest_line3;
            reply_message += comments_line;
          }
          term.echo(reply_message, {raw:true});
          term.set_prompt('[guest@reddit comments]# ');
        });
      });
    // VIEW MORE COMMENTS THREAD
    } else if (posts.length !== 0 && command[0] == "reddit" && command[1] == "view" && command[2] == "comments" && command[3] == "more" && command[4]) {
      $.getJSON(comments[command[4]]+"/.json?jsonp=?", function foo(result) {
        $.each(result[1].data.children, function (i, reply) {
          var reply_message = "";
          var reply2_message = "";
          author = reply.data.author;
          body = reply.data.body;
          created = reply.data.created_utc;
          time = moment.unix(created).fromNow();
          ups = reply.data.ups;
          line1 = body + "<br />";
          line2 = "<span style='margin-left:32px;color: #666;'>posted " + time + " by " + author + " with " + ups + " upvotes</span><p/>";
          reply_message += line1 + line2;
          if (reply.data.replies != "") {
            console.log(reply.data.replies);
            $.each(reply.data.replies.data.children, function (z, reply2) {
              console.log(reply2);
              if (reply2.kind == "more") {
                nested_id = reply2.data.id;
                comments.push(json_base+nested_id);
                nest_line1 = "<span style='margin-left:64px;'>[<span style='color: #B3A600;'>" + r + "</span>] view more comments ...<p />";
                reply_message += nest_line1;
              } else {
                nested_author = reply2.data.author;
                nested_body = reply2.data.body;
                nested_created = reply2.data.created_utc;
                nested_time = moment.unix(nested_created).fromNow();
                nested_ups = reply2.data.ups;
                nest_line1 = "<span style='margin-left:64px;'>" + nested_body + "<br />";
                nest_line2 = "<span style='margin-left:98px;color: #666;'>posted " + nested_time + " by " + nested_author + " with " + nested_ups + " upvotes</span><p/>";
                reply_message += nest_line1 + nest_line2;
              }
            });
            
          }
          r = r + 1;
          term.echo(reply_message, {raw:true});
          term.set_prompt('[guest@reddit comments]# ');
        });
      });
    } else if (cmd == "help") {
      greetings(term);
    } else {
      posts = [];
      comments = [];
      next = "";
      previous = "";
      c = 0;
      r = 0;
      term.echo("command not recognized", {raw:true});
    }
  }, {
    name: 'xxx',
    greetings: null,
    onInit: function(term) {
      greetings(term);
      term.set_prompt('[guest@reddit ~]# ');
    },
    keydown: function(e) {
      if (anim) {
        return false;
      }
    }
  });
});
</script>